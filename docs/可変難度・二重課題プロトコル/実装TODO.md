# 可変難度・二重課題プロトコル 実装TODOリスト

## Phase 1: 基盤システム準備（Week 1）

### 1.1 プロジェクト設定
- [ ] 新しいブランチ作成: `feature/dual-task-protocol`
- [ ] 必要な依存関係の追加
  - [ ] flutter_tts (Text-to-Speech)
  - [ ] speech_to_text (音声認識)
  - [ ] audioplayers (音声再生制御)
- [ ] pubspec.yamlの更新とpackage取得

### 1.2 データモデル設計
- [ ] N-back課題用のデータモデル作成
  ```dart
  class NBackTask {
    final int nLevel; // 0, 1, 2
    final List<int> sequence;
    final List<NBackResponse> responses;
  }
  ```
- [ ] 実験セッションモデルの拡張
  - [ ] 認知負荷レベルフィールド追加
  - [ ] N-back成績記録フィールド追加

### 1.3 データベーススキーマ更新
- [ ] 既存のCSV出力形式を拡張
  - [ ] N-back正答率カラム追加
  - [ ] 反応時間カラム追加
  - [ ] 認知負荷レベルカラム追加

## Phase 2: N-backモジュール実装（Week 1-2）

### 2.1 N-back課題ジェネレーター
- [ ] ランダム数字列生成クラス実装
  ```dart
  class NBackSequenceGenerator {
    List<int> generate(int length, {int minDigit = 1, int maxDigit = 9});
  }
  ```
- [ ] 正答判定ロジック実装
- [ ] 単体テスト作成

### 2.2 音声合成システム
- [ ] TTSラッパークラス実装
  - [ ] 言語設定（日本語/英語）
  - [ ] 速度調整機能
  - [ ] 音量調整機能
- [ ] 数字読み上げメソッド実装
- [ ] タイミング制御（2秒間隔）

### 2.3 応答収集システム
- [ ] 音声認識の実装（オプション）
  - [ ] マイク権限取得
  - [ ] 数字認識の最適化
- [ ] ボタン入力UI実装（フォールバック）
  - [ ] 数字ボタングリッド（1-9）
  - [ ] 応答タイムアウト処理

### 2.4 N-back UIコンポーネント
- [ ] N-back表示ウィジェット作成
  - [ ] 現在の数字表示
  - [ ] 応答フィードバック（正解/不正解）
  - [ ] 進行状況インジケーター
- [ ] 設定画面への統合

## Phase 3: 実験制御システム統合（Week 2）

### 3.1 実験モード拡張
- [ ] 既存の実験モードに認知負荷条件を追加
- [ ] 6条件の管理システム実装
  ```dart
  enum CognitiveLoad { none, nBack0, nBack1, nBack2 }
  enum TempoControl { adaptive, fixed }
  ```

### 3.2 実験フロー制御
- [ ] ラテン方格デザイン順序生成器
- [ ] 条件切り替えロジック
- [ ] 休憩タイマー実装
- [ ] 進行状況トラッカー

### 3.3 データ同期システム
- [ ] タイムスタンプ同期メカニズム
  - [ ] IMUデータ（100Hz）
  - [ ] 心拍データ（1Hz）
  - [ ] N-back応答データ
- [ ] バッファリングとフラッシュ処理

## Phase 4: UI/UX改善（Week 2-3）

### 4.1 実験者用インターフェース
- [ ] 実験制御ダッシュボード
  - [ ] 現在の条件表示
  - [ ] 被験者パフォーマンス表示
  - [ ] 緊急停止ボタン
- [ ] リアルタイムモニタリング画面

### 4.2 被験者用インターフェース
- [ ] 指示画面の作成
  - [ ] 各条件の説明
  - [ ] 練習モード
- [ ] NASA-TLX入力画面
- [ ] 休憩中の表示

### 4.3 音声ガイダンス
- [ ] 実験開始/終了アナウンス
- [ ] 条件切り替えアナウンス
- [ ] エラー時の音声フィードバック

## Phase 5: テストと検証（Week 3）

### 5.1 ユニットテスト
- [ ] N-back課題ロジックのテスト
- [ ] データ同期のテスト
- [ ] 順序生成器のテスト

### 5.2 統合テスト
- [ ] 6条件全ての動作確認
- [ ] データ記録の完全性確認
- [ ] タイミング精度の検証

### 5.3 パイロットテスト準備
- [ ] テスト用被験者6名の募集
- [ ] 同意書の準備
- [ ] テスト環境のセットアップ

## Phase 6: データ解析準備（Week 3）

### 6.1 解析スクリプト作成
- [ ] Pythonによるデータ前処理スクリプト
  - [ ] CSV読み込み
  - [ ] 欠損値処理
  - [ ] 変数計算（CV、エントロピー等）
- [ ] R用の統計解析スクリプト
  - [ ] 混合効果モデル
  - [ ] 可視化

### 6.2 レポート生成
- [ ] 自動レポート生成システム
  - [ ] 個人別サマリー
  - [ ] 条件別比較グラフ
- [ ] PDFエクスポート機能

## Phase 7: ドキュメント作成

### 7.1 技術ドキュメント
- [ ] APIドキュメント更新
- [ ] データフォーマット仕様書
- [ ] トラブルシューティングガイド

### 7.2 実験ドキュメント
- [ ] 実験者用マニュアル
- [ ] 被験者用説明書
- [ ] データ管理プロトコル

## リスク管理

### 技術的リスク
- [ ] 音声認識精度の問題 → ボタン入力で代替
- [ ] タイミング同期の問題 → NTPによる時刻同期
- [ ] メモリ使用量の増大 → 定期的なデータフラッシュ

### 実験的リスク
- [ ] 被験者の疲労 → 適切な休憩時間の設定
- [ ] 練習効果 → カウンターバランス設計
- [ ] ドロップアウト → 予備被験者の確保

## 成功指標

- [ ] 全6条件で安定したデータ収集（エラー率<1%）
- [ ] N-back課題の応答率>90%
- [ ] データ同期精度<50ms
- [ ] パイロット被験者からの良好なフィードバック