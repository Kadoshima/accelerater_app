# Flutter Accelerater App - 機能一覧（担当ファイル付き）

## 1. センサー統合とデータ収集

### IMU（慣性計測装置）統合
- M5Stackデバイスへの Bluetooth接続
- リアルタイム加速度データ収集（X, Y, Z軸）
- ジャイロスコープデータ収集（X, Y, Z軸）
- 磁力計データ収集（X, Y, Z軸）
- 代替としてスマートフォン内蔵加速度センサーのサポート
- センサーデータのバッファリングと処理

**担当ファイル:**
- `/lib/models/sensor_data.dart` - `M5SensorData`クラス（センサーデータモデル）
- `/lib/domain/entities/bluetooth_device.dart` - Bluetoothデバイスエンティティ
- `/lib/domain/usecases/bluetooth/get_imu_data_usecase.dart` - IMUデータ取得ユースケース
- `/lib/data/repositories/bluetooth_repository_impl.dart` - Bluetooth実装
- `/lib/services/ble_service.dart` - BLEサービスインターフェース

### 心拍数モニタリング
- Bluetooth心拍センサー接続
- リアルタイム心拍数データ収集
- 心拍数履歴追跡
- グラフによる心拍数可視化

**担当ファイル:**
- `/lib/domain/entities/heart_rate_data.dart` - `HeartRateData`エンティティ
- `/lib/domain/usecases/bluetooth/get_heart_rate_usecase.dart` - 心拍数取得ユースケース
- `/lib/presentation/providers/bluetooth_providers.dart` - Bluetooth関連プロバイダー

## 2. 歩行解析システム

### FFTベース歩行解析
- 高速フーリエ変換を使用したリアルタイム歩数検出
- SPM（毎分歩数）計算
- 信頼性スコア付きケイデンス検出
- 歩行安定性解析
- 変動係数（CV）計算
- 単軸または多軸解析オプション
- 静止/動作検出閾値

**担当ファイル:**
- `/lib/utils/gait_analysis_service.dart` - `GaitAnalysisService`クラス（FFT解析実装）
- `/lib/utils/spm_analysis.dart` - SPM解析ロジック
- `/lib/domain/repositories/gait_analysis_repository.dart` - 歩行解析リポジトリインターフェース
- `/lib/data/repositories/gait_analysis_repository_impl.dart` - 歩行解析リポジトリ実装
- `/lib/presentation/providers/gait_analysis_providers.dart` - 歩行解析プロバイダー

## 3. 適応的テンポ制御

### スマートメトロノームシステム
- Flutterベースメトロノーム実装
- ネイティブプラットフォームメトロノームサポート
- 無意識的歩行誘導のための適応的テンポコントローラー
- 歩行パターンに基づくリアルタイムテンポ調整
- パーソナライゼーションパラメータ（応答性、安定性選好）
- コンフォートゾーン検出と微調整

**担当ファイル:**
- `/lib/services/adaptive_tempo_controller.dart` - `AdaptiveTempoController`クラス
- `/lib/services/metronome.dart` - Flutterメトロノーム（波形生成）
- `/lib/services/native_metronome.dart` - ネイティブメトロノーム
- `/lib/domain/repositories/metronome_repository.dart` - メトロノームリポジトリインターフェース
- `/lib/data/repositories/flutter_metronome_repository_impl.dart` - Flutterメトロノーム実装
- `/lib/data/repositories/native_metronome_repository_impl.dart` - ネイティブメトロノーム実装
- `/lib/presentation/providers/metronome_providers.dart` - メトロノームプロバイダー
- `/lib/domain/usecases/control_metronome_usecase.dart` - メトロノーム制御ユースケース

**プラットフォーム固有実装:**
- Android: `/android/app/src/main/kotlin/com/example/flutter_ble_acc_example/NativeMetronomePlugin.kt`
- iOS: `/ios/Runner/NativeMetronomePlugin.swift`

## 4. 実験管理

### 実験タイプとフェーズ管理
- 従来型順次実験
- ランダム順序実験
- 複数の実験条件（A: 無意識的誘導、B: 意識的誘導、C: コントロール）
- フェーズ管理（準備、ベースライン、適応、誘導、後効果、評価）

**担当ファイル:**
- `/lib/screens/experiment_screen.dart` - メイン実験画面UI
- `/lib/services/experiment_controller.dart` - `ExperimentController`クラス（実験フロー制御）
- `/lib/models/experiment_models.dart` - 実験データモデル（`ExperimentSession`、`ExperimentCondition`、`AdvancedExperimentPhase`）
- `/lib/utils/experiment_utils.dart` - 実験ユーティリティ関数
- `/lib/domain/repositories/experiment_repository.dart` - 実験リポジトリインターフェース
- `/lib/data/repositories/experiment_repository_impl.dart` - 実験リポジトリ実装
- `/lib/presentation/providers/experiment_providers.dart` - 実験関連プロバイダー
- `/lib/domain/usecases/start_experiment_usecase.dart` - 実験開始ユースケース

## 5. データ記録とエクスポート

### データ収集とエクスポート
- 時系列データ記録
- CSVファイル生成
- Azure Blob Storage統合
- ローカルファイルストレージ
- 自動データアップロード

**担当ファイル:**
- `/lib/services/data_upload_service.dart` - データアップロードサービス（プレースホルダー）
- `/lib/services/background_service.dart` - バックグラウンドサービス管理
- `/lib/main.dart` - Azure設定（接続文字列、コンテナ名）

## 6. ユーザーインターフェース

### メイン画面とコンポーネント
- デバイス接続画面
- 実験制御画面
- リアルタイムデータ可視化
- デザインシステムデモ画面

**担当ファイル:**
- `/lib/main.dart` - アプリエントリーポイント
- `/lib/widgets/device_connection_screen.dart` - デバイス接続UI
- `/lib/screens/experiment_screen.dart` - 実験画面
- `/lib/presentation/screens/design_system_demo.dart` - デザインシステムショーケース

### デザインシステム
**担当ファイル:**
- `/lib/core/theme/app_theme.dart` - メインテーマ定義
- `/lib/core/theme/app_colors.dart` - カラーパレット
- `/lib/core/theme/app_typography.dart` - タイポグラフィスタイル
- `/lib/core/theme/app_spacing.dart` - スペーシング定数

### 共通ウィジェット
**担当ファイル:**
- `/lib/presentation/widgets/common/app_button.dart` - カスタムボタン
- `/lib/presentation/widgets/common/app_card.dart` - カスタムカード
- `/lib/presentation/widgets/common/app_text_field.dart` - カスタムテキストフィールド
- `/lib/presentation/widgets/cv_trend_chart.dart` - CV傾向グラフ

## 7. 音響とフィードバック

### メトロノーム機能
- 可変テンポ制御（40-180 BPM）
- クリック音波形生成
- 音量制御、振動フィードバック

**音源ファイル:**
- `/tmp_audio/click1.mp3`、`click2.mp3` - クリック音
- `/tmp_audio/drum.mp3`、`guitar.mp3` - その他の音源

## 8. デバイス接続性

### Bluetooth機能
- マルチデバイスサポート
- 自動再接続
- デバイススキャン

**担当ファイル:**
- `/lib/core/constants/ble_constants.dart` - Bluetooth定数（UUID定義）
- `/lib/domain/usecases/bluetooth/scan_devices_usecase.dart` - デバイススキャンユースケース
- `/lib/domain/usecases/bluetooth/connect_device_usecase.dart` - デバイス接続ユースケース

## 9. アーキテクチャとインフラ

### クリーンアーキテクチャ層
**ドメイン層** (`/lib/domain/`)
- エンティティ、リポジトリインターフェース、ユースケース

**データ層** (`/lib/data/`)
- リポジトリ実装、データソース、モデル

**プレゼンテーション層** (`/lib/presentation/`)
- プロバイダー（Riverpod）、画面、ウィジェット

**サービス層** (`/lib/services/`)
- プラットフォーム固有サービス、外部サービス統合

**コア層** (`/lib/core/`)
- 共有ユーティリティ、定数、テーマ

### 依存性注入
**担当ファイル:**
- `/lib/presentation/providers/service_providers.dart` - サービス依存関係
- `/lib/presentation/providers/usecase_providers.dart` - ユースケースプロバイダー

## 10. エラー処理とユーティリティ

### エラー管理とロギング
**担当ファイル:**
- `/lib/core/errors/app_exceptions.dart` - カスタム例外定義
- `/lib/core/utils/logger_service.dart` - ロギングサービス
- `/lib/core/utils/result.dart` - エラー処理用Result型

### 定数管理
**担当ファイル:**
- `/lib/core/constants/app_constants.dart` - アプリ全体の定数

## プロジェクト設定ファイル

### Flutter設定
- `/pubspec.yaml` - パッケージ依存関係
- `/analysis_options.yaml` - Dart解析オプション

### プラットフォーム設定
- Android: `/android/app/src/main/AndroidManifest.xml`
- iOS: `/ios/Runner/Info.plist`

---

このアプリは研究用の包括的な歩行解析・適応的テンポ制御システムとして、クリーンアーキテクチャに基づいた保守性の高い設計で実装されています。